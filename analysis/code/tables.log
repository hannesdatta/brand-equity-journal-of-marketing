
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.0   Copyright 1985-2015 StataCorp LP
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     Special Edition                  College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

30-user Stata network perpetual license:
       Serial number:  401406221051
         Licensed to:  TiSEM
                       Tilburg University

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  Maximum number of variables is set to 5000; see help set_maxvar.

. do tables.do 

. ./**********************************************************
>         _                       ____
>        ( )                     |____|
>     ___|/________|\____________|____|_______
>    |__/|/_)_|____|_______|\__(_)__(_)_______|
>    |_(_|_/__|__(_)_______|\_________________|
>    |___|____|__________(_)__________________|
>    |________|_________________________(_)___|
>                                         |
>                                         | 
>  * tables.do 
>  * BAV project
>  * Kusum Ailawadi, Harald van Heerde, and Hannes Datta
>  * bug reports: h.datta@tilburguniversity.edu
>  
> / **********************************************************
>  **********************************************************/

. 
. cap log close

. set linesize 255

. 
. version 13

. clear all

. set mem 500m
set memory ignored.
    Memory no longer needs to be set in modern Statas; memory adjustments are performed on the fly automatically.

. set matsize 10000

. set more off

. set seed 04251963

. set sortseed 04251963

. set scheme s2mono

. 
. /* Goal: estimate Model 19, 20, 21 using Random, Fixed and OLS
> */
. 
. /* Estimate elasticities using the same specification */
. 
. local mlist = "MNL_copula_5mmix "

. local path = "d:\DATTA\Dropbox\Tilburg\Projects\BAV\Shared\analysis_hannes\analysis\output\"

. 
. program equity
  1.         syntax, fn(string)
  2.         insheet using "`fn'", clear 
  3.         *drop if bav_asset == .
.         drop if f_relestknow_std == .
  4.         
.         generate cat_brand = cat_name+ "_" +brand_name
  5.         egen cat_brand_num = group(cat_brand)
  6.         gen weights = 1/sbbe_se
  7.         
.         meancenter
  8.                 
.         eststo clear
  9.         
.         eststo m1: quietly reg sbbe_std f_relestknow_std f_energdiff_std [pw = weights], vce(cluster cat_brand_num)
 10.         
.         eststo m2: quietly reg sbbe_std f_relestknow_std f_energdiff_std seccat newbrnd [pw = weights],  vce(cluster cat_brand_num)
 11.         
.         local varlist sbbe_std f_relestknow_std f_energdiff_std seccat newbrnd f_relestknow_stdXseccat f_relestknow_stdXnewbrnd f_energdiff_stdXseccat f_energdiff_stdXnewbrnd
 12.         xtset cat_brand_num
 13.         eststo m3: quietly reg sbbe_std f_relestknow_std f_energdiff_std seccat newbrnd f_relestknow_stdXseccat f_relestknow_stdXnewbrnd f_energdiff_stdXseccat f_energdiff_stdXnewbrnd [pw=weights],  vce(cluster cat_brand_num)
 14.         *eststo m3: quietly xtreg `varlist' [pw=weights], vce(cluster cat_brand_num)
.         
.         eststo m4: quietly reg sbbe_std f_relestknow_std f_energdiff_std seccat newbrnd f_relestknow_stdXseccat f_relestknow_stdXnewbrnd f_energdiff_stdXseccat f_energdiff_stdXnewbrnd,  vce(cluster cat_brand_num)
 15.         
.         eststo m5: quietly xtmixed `varlist' [pw=weights] || cat_brand_num:, mle vce(cluster cat_brand_num)
 16.         
.         local varlist sbbe_std f_relestknow_std f_energdiff_std seccat newbrnd f_relestknow_stdXseccat f_relestknow_stdXnewbrnd f_energdiff_stdXseccat f_energdiff_stdXnewbrnd
 17.         
.         *eststo m6: quietly xtreg `varlist', fe
.         eststo m6: quietly xtreg `varlist', be
 18.         
.         capture erase "$rtf_out"
 19.         esttab m* using "$rtf_out", mtitles("WLS" "WLS" "WLS" "OLS" "RE robust" "Between (no weights)") nodepvar label addnote("") title("Equity") modelwidth(7 7 7 7 7 7 7 7 7)  varwidth(10)
 20.         
.         
. end

. 
. program meancenter
  1.         quietly sum seccat
  2.         g seccat_mc = seccat-r(mean)
  3.         
.         quietly sum newbrnd
  4.         g newbrnd_mc = newbrnd-r(mean)
  5.         
.         g f_relestknow_stdXseccat = f_relestknow_std * seccat_mc
  6.         g f_relestknow_stdXnewbrnd = f_relestknow_std * newbrnd_mc
  7.         g f_energdiff_stdXseccat = f_energdiff_std * seccat_mc
  8.         g f_energdiff_stdXnewbrnd = f_energdiff_std * newbrnd_mc
  9.         
.         label var f_relestknow_std "RelEstKnow_STD"
 10.         label var f_energdiff_std "EnergDiff_STD"
 11.                 
.         label var f_relestknow_stdXseccat "RelEstKnow_STD x second. cat"
 12.         label var f_relestknow_stdXnewbrnd "RelEstKnow_STD x new brand"
 13.         label var f_energdiff_stdXseccat "EnergDiff_STD x second. cat"
 14.         label var f_energdiff_stdXnewbrnd "EnergDiff_STD x new brand"
 15. end

. 
. program load_elasticity
  1.         syntax, fn(string)
  2.         insheet using "`fn'", clear 
  3.         drop if f_relestknow_std == . | elast_std == .
  4.         generate cat_brand = cat_name+ "_" +brand_name
  5.         egen cat_brand_num = group(cat_brand)
  6.         gen weights = 1/elast_se
  7.         
. end

.         
. program elasticity
  1.         syntax, fn(string)
  2.         
.         local varlist elast_std f_relestknow_std f_energdiff_std seccat newbrnd f_relestknow_stdXseccat f_relestknow_stdXnewbrnd f_energdiff_stdXseccat f_energdiff_stdXnewbrnd
  3.         
.         eststo clear
  4.         
.         /* ad */
.         load_elasticity, fn("`fn'")
  5.         keep if var_name=="adstock_bt"
  6.         meancenter
  7.         eststo m1: quietly reg `varlist' [pw=weights] 
  8.         
.         /* fd_bt */
.         load_elasticity, fn("`fn'")
  9.         keep if var_name=="fd_bt"
 10.         meancenter
 11.         eststo m2: quietly reg `varlist' [pw=weights] 
 12.         
.         /* pct_store_skus_bt */
.         load_elasticity, fn("`fn'")
 13.         keep if var_name=="pct_store_skus_bt"
 14.         meancenter
 15.         eststo m3: quietly reg `varlist' [pw=weights]
 16.         
.         /* pi_bt */
.         load_elasticity, fn("`fn'")
 17.         keep if var_name=="pi_bt"
 18.         meancenter
 19.         eststo m4: quietly reg `varlist' [pw=weights] 
 20.         
.         /* rreg_bt */
.         load_elasticity, fn("`fn'")
 21.         keep if var_name=="rreg_pr_bt"
 22.         meancenter
 23.         eststo m5: quietly reg `varlist' [pw=weights] 
 24.         
.         capture erase "$rtf_out"
 25.         esttab m* using "$rtf_out", mtitles("ad" "fd" "pct_store_skus" "pi" "rreg") nodepvar label addnote("All estimated with WLS.") title("Elasticities") modelwidth(8 8 8 8 8) varwidth(20)
 26.         
. end

. 
. *equity
. *elasticity
. foreach m of local mlist {
  2.  *main, wtchoice("`wt'")
.  local equityfn = "`path'\`m'\equity.csv"
  3.  local elastfn = "`path'\`m'\elasticities.csv"
  4.  *display "`equityfn'"
.  global rtf_out "`path'\`m'\stata_equity.rtf"
  5.  equity, fn("`equityfn'")
  6.  
.  global rtf_out "`path'\`m'\stata_elasticities.rtf"
  7.  elasticity, fn("`elastfn'")
  8.  }      
(56 vars, 4,248 obs)
(1,825 observations deleted)
       panel variable:  cat_brand_num (unbalanced)
(output written to d:\DATTA\Dropbox\Tilburg\Projects\BAV\Shared\analysis_hannes\analysis\output\MNL_copula_5mmix\stata_equity.rtf)
(51 vars, 2,205 obs)
(833 observations deleted)
(1,146 observations deleted)
(51 vars, 2,205 obs)
(833 observations deleted)
(1,096 observations deleted)
(51 vars, 2,205 obs)
(833 observations deleted)
(1,082 observations deleted)
(51 vars, 2,205 obs)
(833 observations deleted)
(1,082 observations deleted)
(51 vars, 2,205 obs)
(833 observations deleted)
(1,082 observations deleted)
(output written to d:\DATTA\Dropbox\Tilburg\Projects\BAV\Shared\analysis_hannes\analysis\output\MNL_copula_5mmix\stata_elasticities.rtf)

. 
. 
end of do-file
